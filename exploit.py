import os
import gdb

f=open('count','r') #count folder conatins the count of files
i1=f.read()
i=int(i1.replace('\n','')) #i stores the file no.
f.close()

#There are 2 cases
#In 1st the address where the instruction stored is 0x5655665e and in the 2nd the instruction is stored in 0x555555755816
if os.popen('objdump -M intel -d '+str(i)+'.bin|grep 65e').read()!="": #checks for the cases
    
    #First case
    print(i)
    a=os.popen('objdump -M intel -d '+str(i)+'.bin|grep 65e').read().split(',')[1].replace('\n','') # stores the length of the input
    b=os.popen('objdump -M intel -d '+str(i)+'.bin|grep 665').read().split(',')[1].replace('\n','') # stores the char of the input
    
    #This set of commands give us the unprintable characters that has to be added behind the input
    gdb.execute('file '+str(i)+'.bin')
    gdb.execute('r < \'t1\'')
    a1=gdb.execute('x/4bx 0x56557008',to_string=True).split(':')[1].replace('\t','').replace('\n','').replace(' ','').replace('0x','\\x')

else:
    
    #Second case
    print(i)
    a=os.popen('objdump -M intel -d '+str(i)+'.bin|grep 816').read().split(',')[1].replace('\n','')# stores the length of the input
    b=os.popen('objdump -M intel -d '+str(i)+'.bin|grep 81d').read().split(',')[1].replace('\n','') # stores the char of the input
    
    #This set of commands give us the unprintable characters that has to be added behind the input
    gdb.execute('file '+str(i)+'.bin')
    gdb.execute('r < \'t1\'')
    a1=gdb.execute('x/8bx 0x555555755010',to_string=True).split(':')[1].replace('\t','').replace('\n','').replace(' ','').replace('0x','\\x')
    
    
#stores the firstpart of input in g
j=int(a,16)
k=chr(int(b,16))
g=k*j

#stores the correct input for our program in file inp
os.system('python -c print"\''+g+'\'+\''+a1+'\'" > inp')
       
#runs the program to check if our input is correct or not
os.system('./'+str(i)+'.bin < inp')
gdb.execute('quit')
